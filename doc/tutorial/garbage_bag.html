<!DOCTYPE html>
<!--
  Copyright (C) 2016-2019  by Terry N Bezue

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<html>
<head>
<title>Garbage Bag</title>
<meta name="generator" content="Bluefish 2.2.10" >
<meta name="copyright" content="">
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8">
<meta http-equiv="content-style-type" content="text/css">
<meta http-equiv="expires" content="0">
<link href="yaooc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="yaooc.js"></script>
</head>
<body>
<div id="wrapper">
<script>header();</script>
<script>menu();</script>
<div id="content" class="content">
<div style="overflow-y: scroll; height:900px">
<h2>Garbage Bag</h2>

<p>
With C++, pointers can be wrapped in a smart pointer so that when it goes out of scope, the object
is deleted. In YAOOC, the garbage bag serves a similar purpose.  When objects are created with new,
it can be stored in the garbage bag. When the garbage bag is deleted, all pointers in bag are deleted
as well.  Pointers to objects stored in garbage bag must have been created using new.  Pointers created using
malloc should not be stored in the garbage bag. For basic usage, YAOOC provides the following macros
for using garbage bags.
</p>

<div class="divTable">
<div class="divTableBody">
<div class="divTableRow">
<div class="divTableHead">Macro</div>
<div class="divTableHead">Purpose</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_init()</div>
<div class="divTableCell">Create a new garbage bag called local_gb</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_save(ptr)</div>
<div class="divTableCell">Save pointer in garbage bag and returns value being saved</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_clear()</div>
<div class="divTableCell">Removes pointers from garbage bag without deleting pointers</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_delete()</div>
<div class="divTableCell">Deletes pointers in garbage bag.  More pointer can still be saved</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_exit()</div>
<div class="divTableCell">Deletes pointers in garbage bag and destroys garbage bag.</div>
</div>
</div>
</div>

<p>
Generally, gb_init() is specified at the beginning of a method.  gb_save() is used to save pointer within the method. gb_exit is used before
exiting method.
</p>

<pre><code>
  int some_method() {
    <font color="red">gb_init()</font>;
    int rc=0;
    my_string_pointer sp=<font color="red">gb_save</font>(new(my_string));
    ...
    char *temp = <font color="red">gb_save</font>(new_array(char,128));
    ...
    sp=<font color="red">gb_save</font>(new_ctor(my_string,my_string_ctor_ccs,"This will be deleted when garbage bag is deleted"));
    ...
    <font color="red">gb_exit();</font>
    return rc;
  }
</code></pre>

<p>
YAOOC also provides macros that combine new and gb_save.  They are shown in the following table.
</p>

<div class="divTable">
  <div class="divTableBody">
    <div class="divTableRow">
      <div class="divTableHead">Macro</div>
      <div class="divTableHead">Purpose</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_new(T)</div>
      <div class="divTableCell">Same as gb_save(new(T))</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_new_array(T,N)</div>
      <div class="divTableCell">Same as gb_save(new_array(T,N))</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_new_copy(P)</div>
      <div class="divTableCell">Same as gb_save(new_copy(P))</div>
    </div>
  </div>
</div>

<p>
Static variables can also be placed in the garbage bag.  For static variables, only the destructor
is called.
</p>

<div class="divTable">
<div class="divTableBody">
<div class="divTableRow">
<div class="divTableHead">Macro</div>
<div class="divTableHead">Purpose</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_save_static(P,T)</div>
<div class="divTableCell">Save static variable in garbage bag</div>
</div>
<div class="divTableRow">
<div class="divTableCell">gb_save_array_static(P,T,N)</div>
<div class="divTableCell">Save static array in garbage bag</div>
</div>
</div>
</div>
</div>

<p>
YAOOC also provides macros than combine placement new and pbsave.
</p>

<div class="divTable">
  <div class="divTableBody">
    <div class="divTableRow">
      <div class="divTableHead">Macro</div>
      <div class="divTableHead">Purpose</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_newp(ptr,T)</div>
      <div class="divTableCell">Same as gb_save_static(newp(ptr,T),T)</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_newp_array(ptr,T,N)</div>
      <div class="divTableCell">Same as gb_save_static(new_array(ptr,T,N),T)</div>
    </div>
    <div class="divTableRow">
      <div class="divTableCell">gb_newp_copy_static(ptr,T)</div>
      <div class="divTableCell">Same as gb_save_static(new_copy(ptr,T),T)</div>
    </div>
  </div>
</div>

</div>
</div>
</div>
</body>
</html>
